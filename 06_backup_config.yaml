---
- name: Backup Device Configurations
  hosts: all
  gather_facts: no

  tasks:
    - name: Ensure backup directory exists
      ansible.builtin.file:
        path: backups
        state: directory
      delegate_to: localhost
      run_once: true

    - name: Backup running configuration
      cisco.ios.ios_command:
        commands:
          - show running-config
      register: running_config

    - name: Save configuration to file
      ansible.builtin.copy:
        content: "{{ running_config.stdout[0] }}"
        dest: "backups/{{ inventory_hostname }}_running_config.txt"
      delegate_to: localhost
